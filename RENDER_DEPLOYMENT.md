# Render Deployment Guide - WhatsApp Ordering System

## Overview
This guide walks you through deploying the WhatsApp Ordering System to Render.com. Render provides a simple way to deploy full-stack applications with integrated databases and services.

## Prerequisites
1. **Render Account**: Sign up at [render.com](https://render.com)
2. **GitHub Repository**: Push your code to GitHub
3. **Twilio Account**: With WhatsApp integration configured
4. **Environment Variables Ready**: Gather all required credentials

## Deployment Steps

### Step 1: Connect GitHub to Render
1. Go to [render.com dashboard](https://dashboard.render.com)
2. Click **New +** → **Blueprint**
3. Select **Public Git repository**
4. Paste your repository URL: `https://github.com/your-username/whatsapp-ordering-system`
5. Click **Connect**

### Step 2: Configure Services
Render will read `render.yaml` and automatically set up:
- PostgreSQL database
- Redis instance
- Backend API server
- Frontend static site

### Step 3: Set Environment Variables
After creating the blueprint, you need to configure these required environment variables in Render dashboard:

#### Critical Variables (must be set):
```
TWILIO_ACCOUNT_SID=your_account_sid
TWILIO_AUTH_TOKEN=your_auth_token
TWILIO_PHONE_NUMBER=+14155238886
TWILIO_WHATSAPP_NUMBER=+14155238886
WEBHOOK_URL=https://whatsapp-backend-xxx.onrender.com/api/v1/whatsapp/webhook
DOMAIN=your-domain.com
ADMIN_EMAIL=admin@example.com
ADMIN_PASSWORD=strong_secure_password
JWT_SECRET=generate_a_strong_random_string
```

#### Auto-Generated Variables:
The following are automatically generated by Render:
- `DATABASE_URL` - PostgreSQL connection string
- `REDIS_HOST` and `REDIS_PORT` - Redis connection details

### Step 4: Initial Database Setup
1. Wait for all services to deploy successfully (check **Events** tab)
2. Once deployed, your backend health check should pass:
   ```
   https://whatsapp-backend-xxx.onrender.com/health
   ```

3. **Important**: Run database migrations on first deploy:
   - Connect to backend via Render shell, or
   - Use the seed script: `npm run db:seed`

### Step 5: Configure Twilio Webhooks
1. Go to Twilio Console
2. Navigate to **Messaging → Webhooks**
3. Set the webhook URL to:
   ```
   https://whatsapp-backend-xxx.onrender.com/api/v1/whatsapp/webhook
   ```
4. Save and test the webhook

### Step 6: Update Custom Domain (Optional)
1. In Render dashboard, go to your backend service
2. Click **Settings** → **Custom Domain**
3. Add your domain and follow DNS instructions
4. Update `DOMAIN` environment variable
5. Update Twilio webhook URL to use new domain

## Service URLs After Deployment

| Service | URL |
|---------|-----|
| Backend API | `https://whatsapp-backend-xxx.onrender.com` |
| Frontend Dashboard | `https://whatsapp-frontend-xxx.onrender.com` |
| Health Check | `https://whatsapp-backend-xxx.onrender.com/health` |
| API Docs | `https://whatsapp-backend-xxx.onrender.com/api/docs` |

## Monitoring & Logs

### View Service Logs
1. Open Render dashboard
2. Click on service name
3. Go to **Logs** tab
4. Filter by service (Backend, Database, Redis)

### Monitor Performance
1. Click **Metrics** tab to see:
   - CPU usage
   - Memory consumption
   - Response times
   - Error rates

## Troubleshooting

### Database Connection Error
**Symptom**: `ECONNREFUSED` errors in backend logs

**Solution**:
1. Check `DATABASE_URL` is set correctly
2. Restart the backend service
3. Run: `npm run db:migrate`

### Twilio Webhook Failing
**Symptom**: Messages not being received

**Solution**:
1. Verify webhook URL is correct in Twilio console
2. Check backend logs for errors
3. Test webhook with Twilio sandbox first

### Redis Connection Error
**Symptom**: Queue jobs not processing

**Solution**:
1. Verify `REDIS_HOST` and `REDIS_PORT` are set
2. Check Redis service is running
3. Restart backend service

### Build Failures
**Symptom**: Deployment fails with build error

**Solution**:
1. Check **Build Logs** tab
2. Ensure `package.json` scripts are correct
3. Verify dependencies are properly listed
4. Check Node version compatibility (Node 18+)

## Security Best Practices

1. **Never commit `.env` file** to repository
2. **Use strong passwords** for admin and JWT secret
3. **Rotate Twilio credentials** regularly
4. **Enable Render auto-deploy** only for main branch
5. **Monitor API logs** for suspicious activity
6. **Keep dependencies updated** - enable Render auto-updates

## Continuous Deployment

### Auto-Deploy Settings
- Render automatically deploys when you push to:
  - Branch: `main` (default)
  - Changes in: `backend/` or `frontend/` directories

### Manual Redeploy
1. Go to service in Render dashboard
2. Click **Manual Deploy** button
3. Select branch and version
4. Click **Deploy**

## Scaling

### Vertical Scaling (increase resources)
1. Go to service **Settings**
2. Under **Instance Type**, upgrade to higher tier
3. Service will restart automatically

### Horizontal Scaling
- Render handles auto-scaling based on demand
- Monitor **Metrics** to adjust plan if needed

## Cost Optimization

| Service | Type | Starting Price |
|---------|------|-----------------|
| PostgreSQL | Managed Database | $7/month |
| Redis | Managed Cache | $6/month |
| Backend (web) | Standard | $7/month |
| Frontend (static) | Free tier available | $0-7/month |

**Total Minimum**: ~$20/month for production setup

## Rollback to Previous Deployment

1. Go to service **Deploys** tab
2. Find previous successful deployment
3. Click **Redeploy** button
4. Confirm

## Next Steps

1. ✅ Verify all services are healthy
2. ✅ Test ordering flow end-to-end
3. ✅ Set up monitoring alerts
4. ✅ Configure daily backups
5. ✅ Document custom configurations

## Support & Resources

- [Render Docs](https://render.com/docs)
- [Render Status Page](https://status.render.com)
- [WhatsApp API Docs](https://developers.facebook.com/docs/whatsapp)
- [Twilio Docs](https://www.twilio.com/docs)

---

**Last Updated**: January 24, 2026
