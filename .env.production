# =============================================================================
# WHATSAPP ORDERING SYSTEM - PRODUCTION ENVIRONMENT VARIABLES
# =============================================================================
# DO NOT COMMIT THIS FILE TO VERSION CONTROL!
# Copy .env.example and fill in actual production values
# =============================================================================

# =============================================================================
# CORE APPLICATION
# =============================================================================
NODE_ENV=production
PORT=5000
APP_VERSION=1.0.0

# =============================================================================
# DATABASE (PostgreSQL)
# =============================================================================
# Required: PostgreSQL connection string
# Format: postgresql://user:password@host:port/database?sslmode=require
DATABASE_URL=postgresql://user:password@prod-db.host:5432/whatsapp_ordering?sslmode=require

# =============================================================================
# REDIS (BullMQ Job Queue & Caching)
# =============================================================================
# Either REDIS_URL or individual REDIS_HOST/REDIS_PORT/REDIS_PASSWORD
# Option 1: Full URL (for managed Redis services like Render, Railway)
REDIS_URL=rediss://user:password@prod-redis.host:6379

# Option 2: Individual components (for self-hosted Redis)
REDIS_HOST=redis.prod.host
REDIS_PORT=6379
REDIS_PASSWORD=secure_redis_password_here

# =============================================================================
# JWT & SECURITY
# =============================================================================
# Used in: src/services/auth.service.js, src/middleware/auth.middleware.js
JWT_SECRET=generate_strong_random_string_at_least_32_characters
JWT_EXPIRES_IN=7d

# =============================================================================
# TWILIO (WhatsApp Integration)
# =============================================================================
# Get from: https://www.twilio.com/console
# Used in: src/services/whatsapp.service.js
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your_auth_token_here
TWILIO_WHATSAPP_FROM=whatsapp:+14155238886
TWILIO_PHONE_NUMBER=+14155238886

# Webhook URL for Twilio callbacks
# Used in: src/middleware/production.middleware.js
WEBHOOK_URL=https://your-production-domain.com/api/v1/whatsapp/webhook

# Force Twilio signature verification in production
# Used in: src/middleware/production.middleware.js
FORCE_TWILIO_VERIFY=true

# =============================================================================
# SECURITY - IP ALLOWLIST
# =============================================================================
# Enable IP allowlist for webhook endpoints
# Used in: src/config/security.config.js
WEBHOOK_IP_ALLOWLIST_ENABLED=true

# Comma-separated list of allowed IPs for webhooks
# Include Twilio IP ranges for production
WEBHOOK_ALLOWED_IPS=54.172.60.0/22,54.244.51.0/24,157.240.0.0/16,31.13.0.0/16

# Enable strict mode (reject requests from non-allowlisted IPs)
# Used in: src/config/security.config.js
WEBHOOK_STRICT_MODE=true

# Validation strict mode
# Used in: src/config/security.config.js
VALIDATION_STRICT_MODE=true

# =============================================================================
# CORS CONFIGURATION
# =============================================================================
# Comma-separated list of allowed origins
# Used in: src/config/security.config.js, src/middleware/production.middleware.js
CORS_ORIGIN=https://yourfrontend.com,https://admin.yourfrontend.com

# =============================================================================
# EMAIL (Notifications & Alerts)
# =============================================================================
# Used in: src/services/email.service.js
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=true
SMTP_USER=notifications@yourcompany.com
SMTP_PASS=your_email_app_password_here
ADMIN_EMAIL=admin@yourcompany.com
BUSINESS_NAME=YourCompany Trading

# =============================================================================
# OPENAI (Optional - for AI Features)
# =============================================================================
# Get from: https://platform.openai.com/account/api-keys
# Used in: src/services/vision.service.js
OPENAI_API_KEY=sk-proj-your-api-key-here
OPENAI_MODEL=gpt-4

# =============================================================================
# LOGGING & OBSERVABILITY
# =============================================================================
# Log level: error, warn, info, debug, trace
# Used in: src/config/observability.config.js, src/config/logger.js
LOG_LEVEL=info

# Log format: pretty (development) or json (production)
# Used in: src/config/observability.config.js, src/config/logger.js
LOG_FORMAT=json

LOG_FILE_PATH=./logs

# Tracing configuration
# Used in: src/config/observability.config.js
TRACING_ENABLED=true
TRACE_SAMPLING_RATE=0.1
TRACE_INCLUDE_BODIES=false

# Metrics collection
# Used in: src/config/observability.config.js
METRICS_ENABLED=true

# =============================================================================
# ALERTING & MONITORING
# =============================================================================
# Enable alerting system
# Used in: src/config/observability.config.js
ALERTING_ENABLED=true

# Alert thresholds
# Used in: src/config/observability.config.js
ALERT_ERROR_RATE=10
ALERT_RESPONSE_TIME_P95=5000
ALERT_CREDIT_FAILURE_RATE=5
ALERT_VENDOR_RESPONSE_TIME=10000
ALERT_ORDER_LIFECYCLE_TIME=300000

# Alert channels (provide URLs/emails for enabled channels)
# Used in: src/config/observability.config.js
ALERT_WEBHOOK_URL=https://your-webhook-endpoint.com
ALERT_EMAIL=alerts@yourcompany.com
ALERT_SLACK_WEBHOOK=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
ALERT_PAGERDUTY_KEY=your_pagerduty_integration_key

# Alert cooldown period (milliseconds)
# Used in: src/config/observability.config.js
ALERT_COOLDOWN=300000

# =============================================================================
# RATE LIMITING
# =============================================================================
# Window for rate limiting (milliseconds)
RATE_LIMIT_WINDOW_MS=900000

# Maximum requests per window
RATE_LIMIT_MAX_REQUESTS=100

# =============================================================================
# TRANSACTION SAFETY
# =============================================================================
# Disable transaction guard if using managed database transactions
# Used in: src/utils/transaction-guard.js
DISABLE_TRANSACTION_GUARD=false

# =============================================================================
# FEATURE FLAGS
# =============================================================================
ENABLE_BIDDING=true
ENABLE_CREDIT_SYSTEM=true
ENABLE_AUTO_RECOVERY=true
ENABLE_DAILY_REPORTS=true

# =============================================================================
# DEVELOPMENT/TESTING OVERRIDES (Do not use in production)
# =============================================================================
# Use mock Twilio in development
USE_MOCK_TWILIO=false

# Mock Twilio endpoint
MOCK_TWILIO_URL=http://localhost:3001

# Auto-seed database on startup
AUTO_SEED=false

# Initial admin credentials (change immediately after first setup)
ADMIN_PHONE=+9779800000000
ADMIN_PASSWORD=change_this_password_immediately
