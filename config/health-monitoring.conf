################################################################################
# System Health Monitoring Configuration
#
# File: /etc/monitoring/health-monitoring.conf
# Purpose: Configure all monitoring thresholds and behaviors
#
# This file is sourced by:
#   - health-check.sh (every 5 minutes)
#   - generate-health-report.sh (daily at 6:00 AM)
################################################################################

###############################################################################
# GENERAL CONFIGURATION
###############################################################################

# Enable/disable monitoring
MONITORING_ENABLED=true

# Monitoring directories
MONITORING_DIR="/var/monitoring/health"
STATE_DIR="/var/lib/monitoring"
LOG_DIR="/var/log/monitoring"
CONFIG_DIR="/etc/monitoring"

# Report generation
ENABLE_EMAIL_REPORT=true
ENABLE_WHATSAPP_REPORT=false

# Report recipients
EMAIL_REPORT_RECIPIENT="ops-team@company.com"
WHATSAPP_REPORT_NUMBER=""  # Set WhatsApp number if enabled

###############################################################################
# DISK SPACE THRESHOLDS
###############################################################################

# Disk usage percentage thresholds
DISK_SPACE_THRESHOLD=85              # CRITICAL alert when >= 85%
DISK_SPACE_WARNING=80                # WARNING alert when >= 80%
DISK_SPACE_OK=75                     # OK status when <= 75%

# Inode usage percentage thresholds
DISK_INODE_THRESHOLD=90              # CRITICAL alert when >= 90%
DISK_INODE_WARNING=85                # WARNING alert when >= 85%

# Monitored directories for size tracking
MONITOR_DIRS=(
    "/backups/postgres"
    "/var/log/backups"
    "/var/lib/postgresql"
)

###############################################################################
# DATABASE CONNECTION THRESHOLDS
###############################################################################

# PostgreSQL connection limits (percentage of max_connections)
DB_CONNECTION_CRITICAL=95            # CRITICAL alert when >= 95% of max
DB_CONNECTION_WARNING=80             # WARNING alert when >= 80% of max
DB_CONNECTION_OK=60                  # OK when <= 60%

# Database configuration
DB_NAME="ordering_system"
DB_HOST="localhost"
DB_PORT="5432"
DB_USER="postgres"
DB_PASSWORD="${DATABASE_PASSWORD:-}"  # Set from environment

# Connection check interval
DB_CHECK_INTERVAL=300                # seconds (5 minutes)

###############################################################################
# QUEUE BACKLOG THRESHOLDS
###############################################################################

# Redis queue backlog thresholds
QUEUE_BACKLOG_CRITICAL=500           # CRITICAL: >= 500 pending messages
QUEUE_BACKLOG_WARNING=100            # WARNING: >= 100 pending messages
QUEUE_BACKLOG_OK=50                  # OK: <= 50 pending messages

# Monitored queue names
QUEUES=(
    "whatsapp-messages"               # WhatsApp message processing
    "webhook-events"                  # Incoming webhook events
    "order-processing"                # Order processing pipeline
    "notifications"                   # System notifications
)

# Redis configuration
REDIS_HOST="localhost"
REDIS_PORT="6379"
REDIS_PASSWORD=""                    # Set if Redis requires password

# Queue check interval
QUEUE_CHECK_INTERVAL=300             # seconds (5 minutes)

###############################################################################
# CPU & MEMORY THRESHOLDS
###############################################################################

# CPU usage percentage
CPU_LOAD_CRITICAL=95                 # CRITICAL alert when >= 95%
CPU_LOAD_WARNING=80                  # WARNING alert when >= 80%
CPU_LOAD_OK=60                       # OK when <= 60%

# Memory usage percentage
MEMORY_CRITICAL=95                   # CRITICAL alert when >= 95%
MEMORY_WARNING=85                    # WARNING alert when >= 85%
MEMORY_OK=75                         # OK when <= 75%

# CPU check interval
RESOURCE_CHECK_INTERVAL=300          # seconds (5 minutes)

###############################################################################
# UPTIME MONITORING
###############################################################################

# Recent reboot detection (seconds)
RECENT_REBOOT_THRESHOLD=300          # Alert if uptime < 5 minutes

# Uptime check interval
UPTIME_CHECK_INTERVAL=3600           # seconds (1 hour)

###############################################################################
# BACKUP HEALTH THRESHOLDS
###############################################################################

# Backup age thresholds (hours)
BACKUP_CRITICAL_AGE=48               # CRITICAL: Backup older than 48h
BACKUP_WARNING_AGE=26                # WARNING: Backup older than 26h
BACKUP_OK_AGE=24                     # OK: Backup within 24h

# Backup verification
REQUIRE_DAILY_VERIFICATION=true      # Require daily verification
BACKUP_VERIFY_INTERVAL=3600          # seconds (1 hour)

###############################################################################
# SERVICE HEALTH MONITORING
###############################################################################

# Critical services to monitor
CRITICAL_SERVICES=(
    "postgresql"                      # PostgreSQL database
    "nginx"                           # Web server
    "redis-server"                    # Redis cache
)

# Optional services (won't alert if not enabled)
OPTIONAL_SERVICES=(
    "docker"                          # Docker daemon
)

# Service check interval
SERVICE_CHECK_INTERVAL=300           # seconds (5 minutes)

###############################################################################
# APPLICATION HEALTH MONITORING
###############################################################################

# Application health check endpoint
APP_URL="http://localhost:3000"
HEALTH_ENDPOINT="/health"
HEALTH_CHECK_TIMEOUT=5               # seconds

# Expected HTTP status code
EXPECTED_STATUS_CODE=200

# Application check interval
APP_CHECK_INTERVAL=300               # seconds (5 minutes)

###############################################################################
# ALERT CONFIGURATION
###############################################################################

# Alert channels
ENABLE_SLACK=true
ENABLE_PAGERDUTY=false
ENABLE_SENTRY=false
ENABLE_EMAIL=true

# Slack configuration
SLACK_WEBHOOK="${SLACK_WEBHOOK_MONITORING:-}"
SLACK_CHANNEL="#system-alerts"

# PagerDuty configuration
PAGERDUTY_KEY="${PAGERDUTY_KEY_MONITORING:-}"

# Sentry configuration
SENTRY_DSN="${SENTRY_DSN_MONITORING:-}"

# Email configuration
ALERT_EMAIL="ops-team@company.com"

# Alert deduplication (prevent duplicate alerts within X seconds)
ALERT_DEDUP_TIME=300                 # seconds (5 minutes)

# Severity levels for alerts
CRITICAL_SEVERITY="critical"
WARNING_SEVERITY="warning"
INFO_SEVERITY="info"

###############################################################################
# REPORTING CONFIGURATION
###############################################################################

# Daily report generation
DAILY_REPORT_TIME="06:00"            # Generate at 6:00 AM
DAILY_REPORT_TIMEZONE="UTC"

# Report formats
ENABLE_HTML_REPORT=true
ENABLE_JSON_REPORT=true
ENABLE_TEXT_REPORT=false

# Report retention
REPORT_RETENTION_DAYS=30             # Keep reports for 30 days

# Alert log retention
ALERT_LOG_RETENTION_DAYS=90          # Keep alert logs for 90 days

###############################################################################
# MONITORING BEHAVIOR
###############################################################################

# Check intervals (in seconds)
CHECK_INTERVAL=300                   # General check interval (5 minutes)
INTENSIVE_CHECK_INTERVAL=60          # Intensive check interval (1 minute)
BACKGROUND_CHECK_INTERVAL=3600       # Background check interval (1 hour)

# Retry logic
MAX_RETRIES=3                        # Max retries on check failure
RETRY_DELAY=10                       # Retry delay in seconds

# Grace period (ignore alerts during first N minutes after startup)
STARTUP_GRACE_PERIOD=300             # seconds (5 minutes)

# Alert suppression during maintenance windows
ENABLE_MAINTENANCE_MODE=false
MAINTENANCE_START=""                 # Example: "2026-01-22 10:00:00"
MAINTENANCE_END=""                   # Example: "2026-01-22 12:00:00"

###############################################################################
# LOGGING & DEBUG
###############################################################################

# Logging levels
LOG_LEVEL="INFO"                     # DEBUG, INFO, WARNING, ERROR
VERBOSE_LOGGING=false

# Log rotation
LOG_MAX_SIZE=104857600               # 100MB
LOG_RETENTION_DAYS=30

# Debug mode (more detailed logging)
DEBUG_MODE=false

# Metrics export (for external monitoring systems)
ENABLE_PROMETHEUS_METRICS=false
PROMETHEUS_EXPORT_PATH="/var/monitoring/metrics"

###############################################################################
# INTEGRATION POINTS
###############################################################################

# Monitoring system integration
MONITORING_SYSTEM="prometheus"       # Options: prometheus, datadog, newrelic, none
MONITORING_API_KEY=""

# Status page update
ENABLE_STATUS_PAGE_UPDATE=false
STATUS_PAGE_API="https://status.example.com/api"

# Incident creation
ENABLE_AUTO_INCIDENT=true            # Auto-create incident on critical alert
INCIDENT_SYSTEM="jira"               # Options: jira, github, none
INCIDENT_PROJECT="OPS"

###############################################################################
# THRESHOLDS SUMMARY
###############################################################################

# This section summarizes all thresholds for quick reference:
#
# DISK SPACE:
#   OK: <= 75%
#   WARNING: >= 80%
#   CRITICAL: >= 85%
#
# DATABASE CONNECTIONS:
#   OK: <= 60%
#   WARNING: >= 80%
#   CRITICAL: >= 95%
#
# QUEUE BACKLOG:
#   OK: <= 50 messages
#   WARNING: >= 100 messages
#   CRITICAL: >= 500 messages
#
# CPU USAGE:
#   OK: <= 60%
#   WARNING: >= 80%
#   CRITICAL: >= 95%
#
# MEMORY USAGE:
#   OK: <= 75%
#   WARNING: >= 85%
#   CRITICAL: >= 95%
#
# BACKUP AGE:
#   OK: <= 24 hours
#   WARNING: >= 26 hours
#   CRITICAL: >= 48 hours
#
# UPTIME:
#   CRITICAL: < 5 minutes (recent reboot)
#
# SERVICE HEALTH:
#   CRITICAL: Service down (if marked as critical)
#
# APPLICATION HEALTH:
#   CRITICAL: Health check failed

################################################################################
# END OF CONFIGURATION
################################################################################
