# PostgreSQL Backup Configuration
# Save as: .env or source in backup scripts
# IMPORTANT: Keep this file secure (chmod 600)

################################################################################
# PostgreSQL Connection Settings
################################################################################

# Database connection (full URL or individual parameters)
DATABASE_URL="postgresql://postgres:password@localhost:5432/ordering_system"

# Individual connection parameters (overrides DATABASE_URL if set)
DB_NAME="ordering_system"
DB_HOST="localhost"
DB_PORT="5432"
DB_USER="postgres"
DB_PASSWORD="your-db-password"

################################################################################
# Local Backup Configuration
################################################################################

# Directory for local backups
BACKUP_DIR="/backups/postgres"

# How many days to keep local backups (7 days recommended)
BACKUP_RETENTION_DAYS=7

# Enable compression (highly recommended)
ENABLE_COMPRESSION=true

# Compression level (1-9, default 6)
COMPRESSION_LEVEL=6

# Create metadata files for backups
CREATE_METADATA=true

# Enable integrity verification after backup
VERIFY_INTEGRITY=true

# Log directory
LOG_DIR="/var/log/backups"

################################################################################
# AWS S3 Backup Configuration
################################################################################

# AWS Access Key (create IAM user with S3 permissions only)
AWS_ACCESS_KEY_ID="your-access-key-id"
AWS_SECRET_ACCESS_KEY="your-secret-access-key"
AWS_REGION="us-east-1"

# S3 bucket for backups
S3_BUCKET="your-company-postgres-backups"

# Prefix path within bucket
S3_PREFIX="database-backups"

# How many days to keep S3 backups (30 days recommended)
REMOTE_RETENTION_DAYS=30

# S3 storage class (STANDARD, STANDARD_IA, GLACIER)
S3_STORAGE_CLASS="STANDARD_IA"

# Enable S3 versioning for recovery
S3_VERSIONING_ENABLED=true

# Enable S3 server-side encryption
S3_ENCRYPTION_ENABLED=true
S3_ENCRYPTION_ALGORITHM="AES256"

# Enable S3 sync (set to false to disable off-site backups)
ENABLE_S3_SYNC=true

################################################################################
# Google Drive Backup Configuration (Alternative)
################################################################################

# Enable Google Drive sync (alternative to S3)
ENABLE_GDRIVE_SYNC=false

# Google Drive folder ID (create dedicated folder for backups)
GDRIVE_FOLDER_ID="your-google-drive-folder-id"

# Google service account JSON file path
GOOGLE_SERVICE_ACCOUNT_FILE="/etc/backup-configs/google-service-account.json"

################################################################################
# Backup Verification Settings
################################################################################

# How old a backup can be before warning (in hours)
BACKUP_AGE_WARNING_HOURS=26

# Enable automated backup verification
ENABLE_BACKUP_VERIFICATION=true

# Enable test restore during verification (takes longer, uses more resources)
ENABLE_TEST_RESTORE=false

# Enable automatic repair of corrupted backups
ENABLE_AUTO_REPAIR=true

################################################################################
# Monitoring and Alerting
################################################################################

# Enable Slack notifications
ENABLE_SLACK=true
SLACK_WEBHOOK="https://hooks.slack.com/services/YOUR/WEBHOOK/URL"
SLACK_CHANNEL="#database-alerts"

# Enable PagerDuty alerts
ENABLE_PAGERDUTY=false
PAGERDUTY_KEY="your-pagerduty-integration-key"

# Enable Sentry error reporting
ENABLE_SENTRY=false
SENTRY_DSN="https://your-sentry-dsn@sentry.io/project-id"

# Enable email alerts
ENABLE_EMAIL=false
ALERT_EMAIL="ops-team@company.com"

# Alert on success (set to false to only alert on failures)
ALERT_ON_SUCCESS=false

################################################################################
# Cron Schedule Settings
################################################################################

# Time for daily backup (cron format)
BACKUP_CRON="0 2 * * *"          # 2:00 AM daily

# Time for S3 sync (cron format)
SYNC_CRON="30 2 * * *"            # 2:30 AM daily

# Time for backup verification (cron format)
VERIFY_CRON="0 3 * * *"           # 3:00 AM daily

# Time for cleanup (cron format)
CLEANUP_CRON="0 1 * * 0"          # 1:00 AM Sunday

################################################################################
# Performance Settings
################################################################################

# Number of parallel jobs for large databases (1-4 recommended)
PARALLEL_JOBS=1

# Batch size for uploads (in MB)
BATCH_SIZE=100

# Maximum concurrent S3 requests
MAX_CONCURRENT_REQUESTS=5

# Network timeout (in seconds)
NETWORK_TIMEOUT=300

################################################################################
# Security Settings
################################################################################

# Backup file permissions (in octal)
BACKUP_FILE_PERMISSIONS="0700"

# Encrypt backups locally before S3 upload (requires gpg)
ENABLE_LOCAL_ENCRYPTION=false
GPG_KEY_ID="your-gpg-key-id"

# Require confirmation for restore operations
REQUIRE_RESTORE_CONFIRMATION=true

# Restrict restore to specific users
ALLOWED_RESTORE_USERS="postgres,root,backup-admin"

################################################################################
# Retention and Cleanup
################################################################################

# Archive old backups to cheaper storage after N days
ARCHIVE_AFTER_DAYS=30

# Delete backups after N days (set to 0 to disable deletion)
DELETE_AFTER_DAYS=90

# Vacuum S3 versions older than N days
S3_VERSION_RETENTION_DAYS=30

################################################################################
# Database-Specific Settings
################################################################################

# Include system tables in backup
INCLUDE_SYSTEM_TABLES=false

# Backup specific schemas only (leave empty for all)
BACKUP_SCHEMAS=""

# Exclude specific tables (comma-separated)
EXCLUDE_TABLES=""

# Enable WAL archiving for point-in-time recovery
ENABLE_WAL_ARCHIVING=false
WAL_ARCHIVE_LOCATION="/backups/wal-archive"

################################################################################
# Development/Testing
################################################################################

# Enable debug logging
DEBUG_MODE=false

# Dry run mode (test without creating actual backups)
DRY_RUN=false

# Verbose output
VERBOSE=true

# Save backup commands for auditing
SAVE_BACKUP_COMMANDS=true
COMMAND_LOG_FILE="/var/log/backups/backup-commands.log"
