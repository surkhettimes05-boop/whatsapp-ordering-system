# =============================================================================
# LOG ROTATION CONFIGURATION
# Manages log files for the WhatsApp ordering system
# =============================================================================

# Global options
compress
delaycompress
missingok
notifempty
sharedscripts

# Application logs
/var/log/app/*.log {
    daily
    rotate 30
    size 100M
    create 644 whatsapp whatsapp
    postrotate
        # Restart services to reopen log files
        docker-compose -f /opt/whatsapp/app/docker-compose.production.yml restart gateway worker || true
    endscript
}

# Nginx logs
/var/log/nginx/*.log {
    daily
    rotate 30
    size 100M
    create 644 nginx nginx
    postrotate
        # Reload nginx to reopen log files
        docker-compose -f /opt/whatsapp/app/docker-compose.production.yml exec nginx nginx -s reload || true
    endscript
}

# System logs (if needed)
/var/log/whatsapp/*.log {
    daily
    rotate 30
    size 50M
    create 644 whatsapp whatsapp
}

# Backup logs
/var/log/backup.log {
    weekly
    rotate 12
    size 10M
    create 644 whatsapp whatsapp
}

# Security logs
/var/log/security.log {
    daily
    rotate 90
    size 50M
    create 644 whatsapp whatsapp
}